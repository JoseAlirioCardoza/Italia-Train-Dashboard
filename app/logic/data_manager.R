# app/logic/data_manager.R
box::use(
  sf[st_read, st_transform],
  dplyr[mutate]
)

#' @export
get_stations_df <- function() {
  # Base de datos finalizada el 2026-01-03 con 99 estaciones y sus IDs RFI oficiales
  df <- data.frame(
    name = c(
      "Roma Termini", "Milano Centrale", "Napoli Centrale", "Firenze S.M.N.", 
      "Torino Porta Nuova", "Venezia S. Lucia", "Bologna Centrale", # T1
      "Verona", "Bari", "Reggio Calabria", "Cagliari", "Palermo", "Genova", "Trieste", 
      "Padova", "Brescia", "Messina", "Catania", "Salerno", "Ancona", "Pescara", 
      "Foggia", "Taranto", "V.Valentia", "Bolzano", "Trento", "Sassari", 
      "L'Aquila", "Benevento", "Ravenna", "Rimini", "ForlÃ¬", "Novara", "Piacenza", 
      "Ferrara", "Siracusa", "Savona", "Alessandria", "Udine", "La Spezia", 
      "Potenza CL", "Rovigo", # T2
      "Imperia", "Monza", "Verbania", "Gorizia", "Massa", "Prato", "Lucca", "Pistoia", 
      "Ascoli", "Varese", "Aosta", "Trapani", "Olbia", "Lecco", "Como", "Bergamo", "Vercelli", 
      "Pavia", "Lodi", "Cremona", "Mantova", "Parma", "Reggio Emilia", "Modena", "Faenza", 
      "Rovereto", "Treviso", "Pesaro", "Perugia", "Terni", "Grosseto", "Siena", "Arezzo", 
      "Livorno", "Pisa", "Civitavecchia", "Viterbo", "Latina", "Frosinone", "Caserta", 
      "Avellino", "Teramo", "Chieti", "Vasto", "Termoli", "San Severo", "Brindisi", "Lecce", 
      "Cosenza", "Crotone", "Isernia", "Macerata", "Cuneo", "Biella", "Ragusa", "Sondrio", "Belluno" # T3
    ),
    lat = c(
      41.9007, 45.4858, 40.8522, 43.7766, 45.0622, 45.4411, 44.5058, # T1
      45.4339, 41.1171, 38.1066, 39.2152, 38.1189, 44.4168, 45.6576, 45.4177, 45.5416, 
      38.1882, 37.5076, 40.6751, 43.6167, 42.4696, 41.4601, 40.4722, 38.6750, 46.4965, 
      46.0673, 40.7259, 42.3489, 41.1297, 44.4178, 44.0609, 44.2227, 45.4485, 45.0514, 
      44.8381, 37.0692, 44.3071, 44.9072, 46.0633, 44.1107, 40.6400, 45.0747, # T2
      43.8860, 45.5843, 45.9220, 45.9405, 44.0366, 43.8777, 43.8430, 43.9333, 42.8538, 
      45.8167, 45.7375, 38.0167, 40.9239, 45.8559, 45.8911, 45.6950, 45.3853, 45.1833, 
      45.3139, 45.1333, 45.1564, 44.8015, 44.6471, 44.5933, 44.2853, 45.8914, 45.7275, 
      43.9108, 43.1107, 42.5714, 42.7667, 43.3183, 43.5233, 43.5485, 43.7085, 42.1000, 
      42.4167, 41.4676, 41.7274, 41.1083, 40.9142, 42.6589, 42.4433, 42.1167, 41.9833, 
      41.6706, 40.6364, 40.3520, 39.2983, 39.0808, 41.6361, 43.3000, 44.3833, 45.4637, 
      36.9282, 46.1689, 46.1628 # T3
    ),
    lng = c(
      12.5013, 9.2035, 14.2706, 11.2478, 7.6784, 12.3211, 11.3430, # T1
      10.9823, 16.8698, 15.6428, 9.1129, 13.3538, 8.9213, 13.7702, 11.8810, 10.2141, 
      15.5555, 15.0931, 14.7725, 13.5167, 14.2142, 15.5441, 17.2361, 16.1014, 11.3548, 
      11.1211, 8.5606, 13.3980, 14.7774, 12.2035, 12.5663, 12.0409, 8.6189, 9.6913, 
      11.6197, 15.2875, 8.4811, 8.6119, 13.2430, 9.8440, 15.8056, 11.7906, # T2
      8.0270, 9.2741, 8.5664, 13.6214, 10.1364, 11.1022, 10.5064, 10.9167, 13.5750, 
      8.8267, 7.3172, 12.5167, 9.5011, 9.3900, 9.0825, 9.6700, 8.4117, 9.1500, 
      9.5000, 10.0228, 10.7914, 10.3279, 10.9258, 10.9272, 11.8828, 11.0422, 12.2428, 
      12.9125, 12.6464, 12.8664, 11.0333, 11.3314, 11.8800, 10.3106, 10.3989, 11.7933, 
      12.1000, 12.9041, 13.2303, 14.2861, 14.7936, 13.6931, 14.1250, 14.7167, 14.9967, 
      15.5483, 17.9369, 18.1741, 16.2522, 17.1278, 14.2389, 13.5381, 7.5500, 8.0441, 
      14.7306, 9.8731, 12.2150 # T3
    ),
    tier = c(rep(1, 7), rep(2, 35), rep(3, 57)),
    rfi_id = c(
      "2416", "1728", "1888", "1342", "2876", "3042", "683", # T1
      "3058", "595", "148", "787", "2013", "1543", "2830", "2000", "734", "1633", 
      "1032", "2617", "429", "2096", "1334", "2811", "165", "685", "2912", "2658", 
      "1510", "626", "2327", "2358", "1369", "1917", "2111", "1309", "2742", "323", 
      "193", "2956", "1507", "2104", "2445", # T2
      "4501", "1841", "3054", "1410", "1618", "2117", "1591", "2161", "469", "2994", 
      "442", "2903", "1931", "1550", "1158", "632", "3014", "2046", "1584", "1202", 
      "1639", "2035", "2331", "1747", "1285", "2440", "2823", "2094", "2092", "2834", 
      "1468", "2730", "458", "1590", "2067", "1123", "3115", "1539", "1377", "945", 
      "483", "2827", "1091", "3028", "2832", "2532", "741", "1549", "50", "52", 
      "1497", "1603", "1211", "649", "2318", "2760", "625" # T3
    ),
    stringsAsFactors = FALSE
  )
  return(df)
}

#' @export
load_infrastructure <- function() {
  path <- "data/ITA_rails.shp"
  if (!file.exists(path)) return(NULL)
  tryCatch({
    st_read(path, quiet = TRUE) |> st_transform(4326)
  }, error = function(e) NULL)
}